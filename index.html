<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exam Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --text: #0f172a; --accent: #1e293b; --success: #22c55e; --error: #ef4444; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        #timer { position: sticky; top: 0; background: var(--accent); color: #fff; padding: 10px; border-radius: 0 0 8px 8px; text-align: center; font-weight: bold; z-index: 1000; margin: -15px -15px 15px -15px; display: none; }
        .setup-container { max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input, select { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .guideline-container { border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px; max-height: 180px; overflow-y: auto; background: #f8fafc; margin-bottom: 10px; }
        .btn-action { background: #e2e8f0; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px; cursor: pointer; margin-right: 5px; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; }
        #main-quiz-area { display: none; }
        .quiz-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .progress-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; margin-bottom: 15px; }
        #progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.4s; }
        .option { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #f1f5f9; border-radius: 10px; text-align: left; cursor: pointer; background: #f8fafc; font-size: 15px; }
        .correct { background: #dcfce7 !important; border-color: var(--success) !important; font-weight: bold; }
        .wrong { background: #fee2e2 !important; border-color: var(--error) !important; }
        .history-section { background: white; padding: 15px; border-radius: 12px; margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .review-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; overflow-y:auto; padding:20px; box-sizing:border-box; }
        .review-content { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; }
    </style>
</head>
<body>

<div id="timer">Time Remaining: 60:00</div>

<div id="setup-screen" class="setup-container">
    <h2 style="margin-top:0">Portal Setup</h2>
    <div class="form-group">
        <label>Subject Name:</label>
        <input type="text" id="subjectName" placeholder="e.g. Managerial Communications">
    </div>
    <div class="form-group">
        <label>Upload Excel Bank:</label>
        <input type="file" id="fileInput" accept=".xlsx, .xls">
    </div>
    <div id="filter-options" style="display:none;">
        <label>Select Guideline(s):</label>
        <div style="margin-bottom: 8px;">
            <button type="button" class="btn-action" onclick="toggleAll(true)">Select All</button>
            <button type="button" class="btn-action" onclick="toggleAll(false)">Deselect All</button>
        </div>
        <div id="guideline-list" class="guideline-container"></div>
        <div class="form-group">
            <label>Number of Questions:</label>
            <input type="number" id="questionCount" value="50">
        </div>
        <button class="btn-primary" onclick="initializeQuiz()">Start Practice Session</button>
    </div>
</div>

<div id="main-quiz-area">
    <div style="text-align:center;"><h2 id="displaySubject" style="margin-bottom:5px;"></h2></div>
    <div class="quiz-card">
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div id="quiz-box">
            <div id="question-text" style="font-weight:600; margin-bottom:15px;"></div>
            <div id="options-container"></div>
            <button id="next-btn" onclick="nextQuestion()" style="display:none; width:100%; padding:15px; margin-top:15px; background:var(--accent); color:white; border:none; border-radius:8px; font-weight:bold;">Next Question â†’</button>
        </div>
        <div id="result-box" style="display:none; text-align:center;">
            <h3>Session Complete!</h3>
            <p id="score-text" style="font-size:1.4rem; font-weight:bold;"></p>
            <button onclick
